# backend

To install dependencies:

```bash
bun install
```

To run:

```bash
bun run index.ts
```

This project was created using `bun init` in bun v1.1.42. [Bun](https://bun.sh) is a fast all-in-one JavaScript runtime.

## Настройка Telegram бота

Для отправки уведомлений о новых публикациях в Telegram необходимо:

1. Создать бота в Telegram через BotFather:
   - Открыть чат с [@BotFather](https://t.me/BotFather)
   - Отправить команду `/newbot`
   - Следовать инструкциям и получить токен бота (API Token)

2. Создать канал в Telegram для публикаций:
   - Создать новый канал
   - Добавить созданного бота как администратора с правами публикации сообщений
   - Получить ID канала (можно через бота [@username_to_id_bot](https://t.me/username_to_id_bot) или отправив сообщение в канал и перехватив его через API)

3. Настроить переменные окружения в файле `.env`:
   ```
   TELEGRAM_BOT_TOKEN="ваш_токен_бота"
   TELEGRAM_CHANNEL_ID="id_вашего_канала" 
   ```

## Использование Telegram бота для рассылки новостей

### Принцип работы

1. При публикации новой статьи или новости (когда isPublished меняется с false на true), информация автоматически сохраняется в стек уведомлений в MongoDB.
2. Стек уведомлений содержит все опубликованные статьи и новости.
3. Администратор может отправить дайджест новостей в Telegram-канал вручную через API эндпоинт.

### Публикация дайджеста новостей

Вы можете отправить накопленные статьи и новости в Telegram-канал одним сообщением:

```bash
# Отправка всех накопленных статей и новостей
curl -X POST http://localhost:3003/telegram/send \
  -H "Content-Type: application/json" \
  -d '{"title": "Дайджест новостей Dr. Sarha"}'

# Отправка статей и новостей за последние 24 часа
curl -X POST http://localhost:3003/telegram/send \
  -H "Content-Type: application/json" \
  -d '{"title": "Дайджест новостей Dr. Sarha", "filterTime": true}'
```

Формат дайджеста:
```
Дайджест новостей Dr. Sarha

Статья: Название статьи 1 - Читать
Новость: Название новости 1 - Читать
Статья: Название статьи 2 - Читать
...
```

Каждая запись содержит активную ссылку на соответствующую страницу сайта.

### Проверка статуса бота

Проверить статус и настройки бота можно через эндпоинт:

```bash
curl http://localhost:3003/telegram/status
```
